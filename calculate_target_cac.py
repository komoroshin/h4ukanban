import pandas as pd
from openpyxl import load_workbook
from openpyxl.utils import get_column_letter
import shutil
from datetime import datetime

file_path = 'finmodel/Office Open XML spreadsheet.xlsx'

print("=" * 80)
print("–†–ê–°–ß–ï–¢ –¶–ï–õ–ï–í–û–ì–û CAC –ù–ê –û–°–ù–û–í–ï –ë–ï–ù–ß–ú–ê–†–ö–û–í B2B SaaS")
print("=" * 80)

# –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Unit economics
df = pd.read_excel(file_path, sheet_name='Unit economics', header=None)

print("\nüìä –¢–ï–ö–£–©–ò–ï –î–ê–ù–ù–´–ï –ò–ó –ú–û–î–ï–õ–ò:")
print("-" * 80)

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
print("\nSubscription price (—Å—Ç—Ä–æ–∫–∞ 6):")
print(df.iloc[5, 2:12].to_string())

print("\nChurn (—Å—Ç—Ä–æ–∫–∞ 9):")
print(df.iloc[8, 2:12].to_string())

print("\nLTV Lifetime (—Å—Ç—Ä–æ–∫–∞ 54-57):")
for idx in [53, 54, 55, 56]:  # 0-based –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å—Ç—Ä–æ–∫ 54-57
    if idx < len(df):
        label = df.iloc[idx, 0]
        values = df.iloc[idx, 2:7]
        print(f"{label}: {values.values}")

print("\n" + "=" * 80)
print("–ë–ï–ù–ß–ú–ê–†–ö–ò B2B SaaS –î–õ–Ø HEALTH/WELLNESS (2026)")
print("=" * 80)

benchmarks = {
    "–ó–¥–æ—Ä–æ–≤—ã–π LTV:CAC ratio": "3:1 –¥–æ 5:1 (–∏–¥–µ–∞–ª—å–Ω–æ 4:1)",
    "CAC Payback Period": "< 12 –º–µ—Å—è—Ü–µ–≤",
    "–°—Ä–µ–¥–Ω–∏–π Churn (B2B SaaS)": "3.5% –≥–æ–¥–æ–≤—ã—Ö (~0.3% –≤ –º–µ—Å—è—Ü)",
    "Health Tech CAC ratio": "2.30 (–¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ $50k-$100k/–≥–æ–¥)",
}

for key, value in benchmarks.items():
    print(f"\n‚úì {key}: {value}")

print("\n" + "=" * 80)
print("–†–ê–°–ß–ï–¢ –¶–ï–õ–ï–í–û–ì–û CAC")
print("=" * 80)

# –ü–æ–ª—É—á–∞–µ–º LTV –∏–∑ –º–æ–¥–µ–ª–∏ (–±–µ—Ä–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
ltv_lifetime_values = df.iloc[53, 3:10].dropna()  # –°—Ç—Ä–æ–∫–∞ 54 (LTV)
avg_ltv = ltv_lifetime_values.mean() if len(ltv_lifetime_values) > 0 else 600

print(f"\nüìà –°—Ä–µ–¥–Ω–∏–π LTV –∏–∑ –º–æ–¥–µ–ª–∏: ${avg_ltv:.2f}")

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–ª–µ–≤–æ–π CAC –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
scenarios = {
    "–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (LTV:CAC = 3:1)": avg_ltv / 3,
    "–ë–∞–∑–æ–≤—ã–π (LTV:CAC = 4:1)": avg_ltv / 4,
    "–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–æ—Å—Ç (LTV:CAC = 2.5:1)": avg_ltv / 2.5,
}

print("\nüéØ –¶–ï–õ–ï–í–û–ô CAC –ü–û –°–¶–ï–ù–ê–†–ò–Ø–ú:")
print("-" * 80)
for scenario, cac_value in scenarios.items():
    print(f"\n{scenario}")
    print(f"  ‚Üí CAC = ${cac_value:.2f}")
    print(f"  ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞: LTV ${avg_ltv:.2f} / CAC ${cac_value:.2f} = {avg_ltv/cac_value:.1f}x")

print("\n" + "=" * 80)
print("–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò")
print("=" * 80)

recommended_cac = avg_ltv / 4  # –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 4:1

print(f"""
üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô CAC: ${recommended_cac:.2f}

–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:
‚Ä¢ LTV:CAC ratio = 4:1 —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–π B2B SaaS —ç–∫–æ–Ω–æ–º–∏–∫–∏
‚Ä¢ –ü—Ä–∏ –≤–∞—à–µ–º LTV ${avg_ltv:.2f}, CAC ${recommended_cac:.2f} –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ä–æ—Å—Ç
‚Ä¢ Payback period –ø—Ä–∏ MRR $100 —Å–æ—Å—Ç–∞–≤–∏—Ç ~{recommended_cac/100:.1f} –º–µ—Å—è—Ü–µ–≤

‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ó–ê–ú–ï–ß–ê–ù–ò–ï –û –í–ê–®–ï–ô –ú–û–î–ï–õ–ò:

–í–∞—à —Ç–µ–∫—É—â–∏–π Churn = 15% –≤ –º–µ—Å—è—Ü - —ç—Ç–æ –û–ß–ï–ù–¨ –í–´–°–û–ö–û –¥–ª—è B2B SaaS!
‚Ä¢ –¢–∏–ø–∏—á–Ω—ã–π B2B SaaS churn: 3.5% –≤ –ì–û–î (~0.3% –≤ –º–µ—Å—è—Ü)
‚Ä¢ –í–∞—à churn: 15% –≤ –ú–ï–°–Ø–¶

–° —Ç–∞–∫–∏–º churn:
‚Ä¢ Lifetime –∫–ª–∏–µ–Ω—Ç–∞ = 1/0.15 = 6.67 –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Ä–µ–¥–Ω–∏–π –∫–ª–∏–µ–Ω—Ç —É—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ø–æ–ª–≥–æ–¥–∞

–î–ª—è B2B –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —ç—Ç–æ –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–æ.

–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ Churn rate –≤ –º–æ–¥–µ–ª–∏!
‚Ä¢ –ï—Å–ª–∏ —ç—Ç–æ –≥–æ–¥–æ–≤–æ–π churn 15%, —Ç–æ –º–µ—Å—è—á–Ω—ã–π = 15%/12 = 1.25%
‚Ä¢ –ï—Å–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≥–æ–¥–æ–≤—ã–µ, —Ç–æ –º–µ—Å—è—á–Ω—ã–π churn –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 1%
""")

print("=" * 80)
print("–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò")
print("=" * 80)
print("""
1. –£—Ç–æ—á–Ω–∏—Ç–µ –º–æ–¥–µ–ª—å Churn:
   ‚Ä¢ 15% - —ç—Ç–æ –º–µ—Å—è—á–Ω—ã–π –∏–ª–∏ –≥–æ–¥–æ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å?
   ‚Ä¢ –î–ª—è B2B —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –æ–±—ã—á–Ω–æ 5-15% –≥–æ–¥–æ–≤–æ–≥–æ churn

2. –ü–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ Churn:
   ‚Ä¢ LTV –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   ‚Ä¢ –¶–µ–ª–µ–≤–æ–π CAC —Ç–∞–∫–∂–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è

3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å CAC –≤ –º–æ–¥–µ–ª–∏:
   ‚Ä¢ –ú–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   ‚Ä¢ –ò–ª–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è Churn

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –∑–∞–ø–æ–ª–Ω–∏–ª CAC –≤ –º–æ–¥–µ–ª—å —Å–µ–π—á–∞—Å? (y/n)
""")
